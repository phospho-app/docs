---
title: Testing with Python
description: "Test your agent before deploying it to production"
---

Evaluate your app's performance before deploying it to production. 

The phospho testing framework allows you to test your app with historical data, custom datasets, and custom tests.

The phospho python module **parallelizes** the function calls to speed up the testing process.


## Backtest

This source loader uses the logged phospho data to evaluate your app's performance. This is great to quickly have representative data to test with.

```python
import phospho 

phospho_test = phospho.PhosphoTest()

@phospho_test.test(
    source_loader="backtest",  # Load data from logged phospho data
    source_loader_params={"sample_size": 3},
)
def test_backtest(message: phospho.lab.Message) -> str | None:
    response = client.chat.completions.create(
        model=model,
        messages=[
            {"role": "system", "content": "You are an helpful assistant"},
            {"role": message.role, "content": message.content},
        ],
    )
    return response.choices[0].message.content

phospho_test.run()
```


### Dataset .CSV, .XLSX, .JSON

To test with a custom dataset, you can use the dataset source loader.


```python
import phospho 

phospho_test = phospho.PhosphoTest()

@phospho_test.test(
    source_loader="dataset", 
    source_loader_params={"path": "path/to/dataset.csv"},
)
def test_backtest(column_a: str, column_b: str) -> str | None:
    response = client.chat.completions.create(
        model=model,
        messages=[
            {"role": "system", "content": "You are an helpful assistant"},
            {"role": "user", "content": column_a},
        ],
    )
    return response.choices[0].message.content

phospho_test.run()
```


Supported file formats: `csv`, `xlsx`, `json`

<Info>
The columns of the dataset file should match the function arguments.
</Info>

Example of a local csv file:

```txt title="path/to/dataset.csv"
column_a, column_b
"What's larger, 3.9 or 3.11 ?", "3.11"
```

## Custom tests

```python
import phospho 

phospho_test = phospho.PhosphoTest()

@phospho_test.test(
    source_loader="dataset", 
    source_loader_params={"path": "path/to/dataset.csv"},
)
def test_backtest(column_a: str, column_b: str) -> str | None:
    response = client.chat.completions.create(
        model=model,
        messages=[
            {"role": "system", "content": "You are an helpful assistant"},
            {"role": "user", "content": column_a},
        ],
    )
    return response.choices[0].message.content

phospho_test.run()
```

## Running the test

To run the test, use the `run` method of the `PhosphoTest` class.

```python
phospho_test.run(executor_type="parallel")
```

The `run` method takes the following parameters:

- `executor_type`: The executor type to use for running the test. This can be either `parallel` or `sequential`. Sequential is great for debugging while parallel offers the best speed. The default is `parallel`.

